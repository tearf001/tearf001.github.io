webpackJsonp([27],{"9XdL":function(e,_,t){(e.exports=t("FZ+f")(!1)).push([e.i,"\n.chart-container[data-v-b10c28a4] {\n  position: relative;\n  padding: 20px;\n  /*width: 100%;*/\n  height: 85vh;\n  font-size: 12px;\n}\n",""])},"Jg+E":function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__=__webpack_require__("mvHQ"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__=__webpack_require__("fZjL"),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys__),__WEBPACK_IMPORTED_MODULE_2_echarts__=__webpack_require__("XLwt"),__WEBPACK_IMPORTED_MODULE_2_echarts___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_echarts__),__WEBPACK_IMPORTED_MODULE_3__utils_helpers_chartOptionMaker__=__webpack_require__("r13W"),__WEBPACK_IMPORTED_MODULE_4__api_pulseGrids__=__webpack_require__("QOdC"),__WEBPACK_IMPORTED_MODULE_5__globals__=__webpack_require__("xtwg"),__WEBPACK_IMPORTED_MODULE_6__utils_helpers_wrapElMsg__=__webpack_require__("LPbS"),__WEBPACK_IMPORTED_MODULE_7__utils__=__webpack_require__("0xDb"),__WEBPACK_IMPORTED_MODULE_8_screenfull__=__webpack_require__("I95x"),__WEBPACK_IMPORTED_MODULE_8_screenfull___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_8_screenfull__),__WEBPACK_IMPORTED_MODULE_9_debounce__=__webpack_require__("HhAh"),__WEBPACK_IMPORTED_MODULE_9_debounce___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_9_debounce__),__WEBPACK_IMPORTED_MODULE_10_element_ui__=__webpack_require__("zL8q"),__WEBPACK_IMPORTED_MODULE_10_element_ui___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_10_element_ui__),struct={series:[{name:"访问来源",type:"pie",radius:"55%",data:[{value:1026,name:"移动发展"},{value:442,name:"无双卡"},{value:672,name:"红包卡"},{value:849,name:"不限量套餐"},{value:552,name:"十全十美套餐"},{value:1049,name:"宽带"},{value:679,name:"ITV"}]}]},today_=new Date,todayZero=Object(__WEBPACK_IMPORTED_MODULE_7__utils__.h)(today_);function filter_unit(e){if(!e.checked)return!1;var _={};return __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(e).forEach(function(t){"path"!==t&&"checked"!==t&&"full_path"!==t&&""!==e[t]&&void 0!==e[t]&&null!==e[t]&&(_[t]=e[t])}),_}__webpack_exports__.a={data:function(){return{chart:null,checkedList:[],cur_leaves:[],selectedSidx:[],loadingTree:"加载中",sd:new Date(todayZero.getFullYear(),todayZero.getMonth(),1),ed:todayZero,twOps:[["天","date"],["周","week"],["月","month"],["年","year",!1]],twSplit:"date",seriesUseGroupStack:!1,ECHART_LIST_MAX:__WEBPACK_IMPORTED_MODULE_5__globals__.i,ECHART_CMP_MAX:__WEBPACK_IMPORTED_MODULE_5__globals__.h,default_area:"某区域",space_id:"",dep_id:"",staff_code:"",site_id:"",sites:[],queryUpdated:!1,querying:!1,site_id_change:"",struct:struct}},name:"lineChart",methods:{initChart:function(){var e=this.struct;this.chart.setOption(e)},AddSelection:function(){var e=this,_=this.cur_leaves,t=this.motion;_.length>=__WEBPACK_IMPORTED_MODULE_5__globals__.i?Object(__WEBPACK_IMPORTED_MODULE_6__utils_helpers_wrapElMsg__.b)("最多只能候选"+__WEBPACK_IMPORTED_MODULE_5__globals__.i+"个单位/个人"):(_.find(function(e){return _=e,i=t,__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_keys___default()(_).every(function(e){return"path"===e||"checked"===e||"full_path"===e||_[e]===i[e]});var _,i})||(this.$set(t,"path",this.$store.getters.getSelectPath(t,_.length>1?1:2)),this.$set(t,"checked",!0),_.push(t)),_.length>2&&_.forEach(function(_,t){var i=_.path.split("/")[0];e.checkedList[t]=i,e.$set(_,"full_path",_.path),e.$set(_,"path",i)}),this.selectedSidx.length>1&&_.filter(function(e){return e.checked}).length>1&&__WEBPACK_IMPORTED_MODULE_10_element_ui__.Message.info("你已经选择了多指标,再多选单位时,这些指标将会合并"))},SidxesChanged:function(e){this.selectedSidx.find(function(e){return-1===e})?this.selectedSidx=[-1]:this.selectedSidx.length>1&&this.cur_leaves.filter(function(e){return e.checked}).length>1&&__WEBPACK_IMPORTED_MODULE_10_element_ui__.Message.info("你已经选择多个单位,多选指标时,这些指标将会合并")},search_sites:__WEBPACK_IMPORTED_MODULE_9_debounce___default()(function(e){this.getSiteManual(e)},500),getSiteManual:function(e){var _=this;this.$store.dispatch("getSiteBy2Factor",[this.space_id,this.dep_id,e]).then(function(e){_.sites=e,e.find(function(e){return e.V===_.site_id})||(_.site_id=void 0)})},scrful_chart:function(){if(__WEBPACK_IMPORTED_MODULE_8_screenfull___default.a.enabled){var e=document.getElementById("echart_pg");__WEBPACK_IMPORTED_MODULE_8_screenfull___default.a.request(e)}},simulate:function(){this.initChart()},GetPulseData:function GetPulseData(ops){var _this3=this,_ref=ops||this,cur_leaves=_ref.cur_leaves,selectedSidx=_ref.selectedSidx,SD=_ref.SD,ED=_ref.ED,twSplit=_ref.twSplit;SD=Object(__WEBPACK_IMPORTED_MODULE_7__utils__.f)(SD).replace(/-/g,"").slice(0,8),ED=Object(__WEBPACK_IMPORTED_MODULE_7__utils__.f)(ED).replace(/-/g,"").slice(0,8),cur_leaves=cur_leaves.filter(filter_unit).map(filter_unit),this.querying=!0,cur_leaves.length&&selectedSidx&&selectedSidx.length&&Object(__WEBPACK_IMPORTED_MODULE_4__api_pulseGrids__.e)({Space:cur_leaves,Sidx:selectedSidx,SD:SD,ED:ED,Scale:"pie"}).then(function(d){try{d=eval("("+d.output+")"),d.series_data&&(_this3.struct=d,_this3.initChart(),_this3.queryUpdated=!1)}catch(e){Object(__WEBPACK_IMPORTED_MODULE_6__utils_helpers_wrapElMsg__.b)("数据返回格式错误",d)}_this3.querying=!1}).catch(function(e){_this3.querying=!1,Object(__WEBPACK_IMPORTED_MODULE_6__utils_helpers_wrapElMsg__.b)("加载数据发生错误",e)})},generateStackedLegend:function(){}},mounted:function(){var e=this;this.chart=__WEBPACK_IMPORTED_MODULE_2_echarts___default.a.init(document.getElementById("echart_pg")),this.simulate(),__WEBPACK_IMPORTED_MODULE_8_screenfull___default.a.on("change",function(){e.chart.resize()})},beforeDestroy:function(){this.chart&&(this.chart.dispose(),this.chart=null,__WEBPACK_IMPORTED_MODULE_8_screenfull___default.a.off("change"))},computed:{fmt:function(){return"week"===this.twSplit?"yyyy 第 WW 周":"date"===this.twSplit?"yyyy-MM-dd":void 0},SD:function(){return"week"===this.twSplit?Object(__WEBPACK_IMPORTED_MODULE_7__utils__.b)(this.sd):this.sd},ED:function(){return"week"===this.twSplit?Object(__WEBPACK_IMPORTED_MODULE_7__utils__.c)(Object(__WEBPACK_IMPORTED_MODULE_7__utils__.h)(Object(__WEBPACK_IMPORTED_MODULE_7__utils__.b)(this.ed),7),todayZero):"month"===this.twSplit?Object(__WEBPACK_IMPORTED_MODULE_7__utils__.c)(new Date(this.ed.getFullYear(),this.ed.getMonth()+1,0),todayZero):Object(__WEBPACK_IMPORTED_MODULE_7__utils__.c)(Object(__WEBPACK_IMPORTED_MODULE_7__utils__.h)(this.ed,1),todayZero)},ORG_BASE:function(){return this.$store.getters.ORG_BASE},deps:function(){return this.$store.getters.getDepBySpace(this.space_id)},spaces:function(){return this.$store.getters.getSpaceByDep(this.dep_id)},sites_mock:function(){return this.sites.length>__WEBPACK_IMPORTED_MODULE_5__globals__.k?this.sites.slice(0,__WEBPACK_IMPORTED_MODULE_5__globals__.k).concat({N:"..还有"+(this.sites.length-__WEBPACK_IMPORTED_MODULE_5__globals__.k)+"个,请通过地域,或输入名称筛选",V:1/0,no:!0}):this.sites},staffs:function(){return this.staff_code="",this.$store.getters.getStaffBySite(this.site_id)},motion:function(){var e=this.staff_code,_=this.site_id,t=this.dep_id,i=this.space_id;return e?{STAFF_CODE:e}:_?{SITE_ID:_}:i||t?{SPACE_ID:i,DEP_ID:t}:void 0},SIDX:function(){return this.$store.getters.SIDX.concat({SIDX_NAME:"全选",SIDX_ID:-1})},SIDX_SELECTED:function(){var e=this;return this.SIDX.filter(function(_){return!!~e.selectedSidx.indexOf(_.SIDX_ID)}).map(function(e){return e.SIDX_NAME})},shouldRender:function(){return"path="+this.cur_leaves.map(function(e){return e.path+":"+e.checked&1}).sort().join("+")+",idx="+this.selectedSidx.sort().join("+")+",scale="+this.twSplit+",from "+this.sd+" to "+this.ed}},watch:{site_id:function(e,_){this.site_id_change="->"+e},shouldRender:function(e,_){var t=this.cur_leaves,i=this.selectedSidx;t=t.filter(filter_unit).map(filter_unit),this.queryUpdated=t.length&&i&&i.length}}}},MJIs:function(e,_,t){"use strict";Object.defineProperty(_,"__esModule",{value:!0});var i=t("Jg+E"),s={render:function(){var e=this,_=e.$createElement,t=e._self._c||_;return t("el-col",{attrs:{span:24}},[t("el-col",{attrs:{span:3}},[t("el-select",{attrs:{placeholder:"选择部门..",size:"mini"},on:{change:function(_){e.getSiteManual()}},model:{value:e.dep_id,callback:function(_){e.dep_id=_},expression:"dep_id"}},[t("el-option",{attrs:{value:""}},[e._v("不选")]),e._v(" "),e._l(e.deps,function(e){return t("el-option",{key:e.V,attrs:{label:e.N,value:e.V}})})],2),e._v(" "),t("el-select",{attrs:{placeholder:"选择地域..",size:"mini"},on:{change:function(_){e.getSiteManual()}},model:{value:e.space_id,callback:function(_){e.space_id=_},expression:"space_id"}},[t("el-option",{attrs:{value:""}},[e._v("不选")]),e._v(" "),e._l(e.spaces,function(e){return t("el-option",{key:e.V,attrs:{label:e.N,value:e.V}})})],2),e._v(" "),t("el-select",{attrs:{placeholder:"选择营业厅",size:"mini",filterable:"","filter-method":e.search_sites},model:{value:e.site_id,callback:function(_){e.site_id=_},expression:"site_id"}},e._l(e.sites_mock,function(e){return t("el-option",{key:e.V,attrs:{label:e.N,value:e.V,disabled:!0===e.no}})})),e._v(" "),t("el-select",{attrs:{placeholder:"业务员",size:"mini"},model:{value:e.staff_code,callback:function(_){e.staff_code=_},expression:"staff_code"}},[t("el-option",{attrs:{value:""}},[e._v("不选")]),e._v(" "),e._l(e.staffs,function(e){return t("el-option",{key:e.STAFF_CODE,attrs:{label:e.STAFF_NAME+"-"+e.STAFF_CODE,value:e.STAFF_CODE}})})],2),e._v(" "),e.space_id||e.dep_id?t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.AddSelection}},[e._v("加入对比")]):e._e()],1),e._v(" "),t("el-col",{staticClass:"chart-container",attrs:{span:21}},[e.checkedList.length?t("span",{attrs:{title:e.checkedList.toString()}},[t("button",{attrs:{onClick:"alert('todo')"}},[e._v("存为默认")])]):t("span",[e._v("默认所在区域:"),t("b",{staticStyle:{color:"darkblue"}},[e._v(e._s(e.default_area))])]),e._v(" "),t("el-checkbox-group",{attrs:{min:1},model:{value:e.checkedList,callback:function(_){e.checkedList=_},expression:"checkedList"}},e._l(e.cur_leaves,function(_,i){return t("el-checkbox",{key:i,attrs:{label:_.path,checked:_.checked,title:_.full_path||_.path},model:{value:_.checked,callback:function(t){e.$set(_,"checked",t)},expression:"lf.checked"}})})),e._v(" "),t("br"),e._v("\n    选择查询区间\n    "),t("el-select",{staticStyle:{width:"60px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.twSplit,callback:function(_){e.twSplit=_},expression:"twSplit"}},e._l(e.twOps,function(e){return t("el-option",{key:e[1],attrs:{label:e[0],value:e[1],disabled:!1===e[2]}})})),e._v(" "),t("el-date-picker",{staticStyle:{width:"130px"},attrs:{type:e.twSplit,format:e.fmt,title:e._f("fmtDate")(e.SD),"picker-options":{firstDayOfWeek:1},size:"mini"},model:{value:e.sd,callback:function(_){e.sd=_},expression:"sd"}}),e._v(" "),t("el-date-picker",{staticStyle:{width:"130px"},attrs:{type:e.twSplit,format:e.fmt,title:e._f("fmtDate")(e.ED),"picker-options":{firstDayOfWeek:1},size:"mini"},model:{value:e.ed,callback:function(_){e.ed=_},expression:"ed"}},[e._v(">")]),e._v(" "),t("el-select",{staticStyle:{width:"400px"},attrs:{multiple:"",placeholder:"选择一个或多个指标",size:"mini"},on:{change:e.SidxesChanged},model:{value:e.selectedSidx,callback:function(_){e.selectedSidx=_},expression:"selectedSidx"}},e._l(e.SIDX,function(e){return t("el-option",{key:e.SIDX_ID,attrs:{value:e.SIDX_ID,label:e.SIDX_NAME}})})),t("el-button",{attrs:{type:"warning",size:"mini",disabled:!e.queryUpdated,loading:e.querying},on:{click:function(_){e.GetPulseData()}}},[e._v("观察")]),e._v(" "),t("br"),e._v(" "),t("button",{attrs:{id:"chartFullScreen"},on:{click:e.scrful_chart}},[e._v("全屏")]),e._v(" "),t("br"),e._v(" "),t("div",{style:{height:"100%",width:"100%"},attrs:{id:"echart_pg"}})],1)],1)},staticRenderFns:[]};var a=function(e){t("leoc")},n=t("VU/8")(i.a,s,!1,a,"data-v-b10c28a4",null);_.default=n.exports},leoc:function(e,_,t){var i=t("9XdL");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);t("rjj0")("67780484",i,!0)}});